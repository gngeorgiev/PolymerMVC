<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../core-meta/core-meta.html" />

<polymer-element name="polymer-view">

  <template>
    <template if="{{selected == 'true'}}">
      <content></content>
    </template>
  </template>

  <script>
    Polymer('polymer-view', {
      publish: {
        selected: 'false',
        $controller: '',
        $controllerName: '',
        attached: false
      },
      ready: function() {
        var host = this.shadowRoot.host;
        if (host.tagName === 'POLYMER-VIEW' || host.tagName === "POLYMER-MVC") {
          host.registerView(this);
        }

        this.enqueueForAttach();
      },
      registerView: function(view) {
        if (!this.views) {
          this.views = [];
        }

        this.views.push(view);
      },
      enqueueForAttach: function() {
        if (!this.$controller || typeof this.$controller !== 'string') {
          return;
        }

        var meta = document.createElement('core-meta');
        meta.type = 'ControllersQueue';
        meta.view = this;
        meta.register(this.$controller);
      },
      attachController: function(controller) {
        this.$controller = controller;
        this.$controller.$view = this;
        this.$scope = this.$controller.$scope;
        this.childNodes.array().forEach(function(node) {
          if (!node.tagName) {
            return;
          }

          node.$controller = controller;
          node.$scope = controller.$scope;
        });
      }
    });
  </script>

</polymer-element>
